---
title: React 18源码学习笔记
date: 2025-10-14 01:40:46 +0800
categories: [前端, React]
tags: [React,学习笔记,源码]
---

# 第一章 基础概念
## 一.虚拟DOM
### 1.什么是虚拟DOM
虚拟DOM是js对象，是对真实DOM的抽象表示：

```javascript
const virtualDOM = {
	type: "div",
	props: {
		className: "container",
		childiren: [
			{
				type: "h1",
				props: {
					children: "Hello World",
				},
			},
		],
	};
```
可以体现出react的设计哲学
### 2.虚拟DOM工作流程
1. 状态变化
2. 生成新的虚拟DOM
3. Diff比较
4. 计算最小更新
5. 批量更新真实DOM
## 二.JSX
### 1.什么是JSX
jsx是js的语法扩展，允许在js中写HTML样的代码
### 2.JSX的编译（Babel转换）
```js
// jsx代码
const element = <div className = "greeting">Hello,{name}!</div>;

//编译成JS的代码
const element = React.createElement(
	"div",
	{ className: "greeting" },
	"Hello, ",
	name,
	"!"
);
```
ceateElemen下的第一行（type），第二行（props），第三行及以下（其他子节点children）
## 三.React Element
### 1.React Element的结构
```js
const element = {
	// 元素类型
	type: "string" | type of ReactComponent,

	// 元素属性
	props: {
		// 标准dom属性
		className: "container",
		style: { color: "red" },

		// React 特殊属性
		key: "unique-key",
		ref: refObjiect,

		//子元素
		children: [
			"文本内容",
			ReactElement,
			[ReactElement],//数组
			null,
			false,
		],
	},

	// 内部属性
	_owner: Fiber,
	_store: {},
	_self: null,
	_source: null,
};
```
### 2.Element类型
原生DOM元素
```js
{
	type: 'div',
	props: { className: 'container' }
}
```

函数组件
```js
{
	type: function Welcome(props) { return <h1>Hello, {props.name}</h1>; },
	props: { name: 'React' }
}
```

类组件
```js
{
	type: class Welcome extends React.Component { ... },
	props: { name: 'React' }
}
```
Fragment
```js
{
	type: Symbol(react.fragment),
	props: { children: [element1, element2] }
}
```
### 3.创建React Element
```js
// 使用React.createELement
const element = React.createElement(
	"div",
	{ className: "greeting" },
	"Hello,World!"
);

// 使用JSX
const element = <div className = "greeting">Hello,World!</div>;

// 使用 React.cloneElement克隆元素
const clonedElement = React.cloneElement(element, {
	className: "greeting-cloned",
});
```
## 三.源码学习重点
### 1.核心文件

 - **packages/react/src/ReactElement.js** - React元素创建
 - **packages/react/src/React.js** - React核心API
 - **packages/react/src/jsx/ReactJSXElement.js** - JSX转换
 ### 2.关键函数
 ```js
 // React.createElement 函数签名
 export function createElement(type, config, children) {
	 // 处理 props
	 // 处理 children
 	 // 创建 ReactElement
 }
// React.cloneElement 函数签名
export function cloneElement(element, config, children) {
	// 克隆现有元素
	// 合并新的 Props
	//返回新元素
}

```
# 第二章 Fiber框架
## 一.简介Fiber
在React 16之前，React使用递归的方式处理组件树，会出现以下问题：
- 无法中断渲染
- 长时间计算阻塞用户交互（主线程）
- 所有更新状态都是同步的，无法确立优先级

 Fiber的核心思想：将渲染工作分解为小的、可中断的工作单位

于是，FIber就引入了一种**协作式调度**机制：
- 把整个组件书的渲染过程拆成一个个小任务（每个Fibet节点就是一个任务单元）
- 每执行完一个任务，就检查是否还有时间继续
- 如果浏览器需要处理用户输入、动画等高优先级任务，React就会暂停当前工作，等空闲时再从断电恢复